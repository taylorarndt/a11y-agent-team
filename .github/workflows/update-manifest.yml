name: Update Agent Manifest

# Regenerates .a11y-agent-manifest in the repo root whenever agents, skills,
# instructions, prompts, or platform extensions are added, renamed, or removed.
# The manifest is the canonical list of all official files and is used by
# install/update scripts to distinguish official files from user-created ones.
#
# Uses scripts/generate-manifest.sh as the single source of truth for
# manifest generation logic (shared with the local PowerShell equivalent).

on:
  push:
    branches: [main]
    paths:
      - ".claude/agents/**"
      - ".github/agents/**"
      - ".github/copilot-*.md"
      - ".github/instructions/**"
      - ".github/skills/**"
      - ".github/prompts/**"
      - ".codex/**"
      - ".gemini/**"
      - "scripts/generate-manifest.sh"

permissions:
  contents: write
  pull-requests: write

jobs:
  update-manifest:
    name: Regenerate .a11y-agent-manifest
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Generate manifest
        run: |
          bash scripts/generate-manifest.sh --write
          echo "---"
          cat .a11y-agent-manifest

      - name: Create PR if manifest changed
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: "chore: update agent manifest [skip ci]"
          title: "chore: update agent manifest"
          body: |
            Auto-generated by the **Update Agent Manifest** workflow.

            The `.a11y-agent-manifest` file was regenerated because agent,
            skill, instruction, prompt, or extension files changed on `main`.
          branch: chore/update-agent-manifest
          delete-branch: true
          labels: automated
